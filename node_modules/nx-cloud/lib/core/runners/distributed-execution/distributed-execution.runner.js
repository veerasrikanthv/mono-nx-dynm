const a11_0x2670=['--skip-nx-cache\x20is\x20ignored\x20when\x20using\x20distributed\x20tasks\x20execution\x20(DTE).','getCIExecutionId','projectGraph','createTaskGraphCompat','skipNxCache','See\x20run\x20details\x20at\x20','taskGraph','scheduleTask','defineProperty','../../../utilities/nx-imports','DteArtifactStorage','encryptionKey','../../../utilities/environment','__esModule','value','warn','getBranch','Unable\x20to\x20complete\x20a\x20run.','done','extractGitSha','submitRunMetrics','splitTasksIntoStages','Command\x20execution\x20failed.','ErrorReporterApi','../../../utilities/nx-imports-light','../../error/print-run-group-error','getCIExecutionEnv','SIGINT','dte-main','Main\x20job\x20was\x20terminated\x20via\x20SIGTERM','axiosException','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','note','lifeCycle','Starting\x20distributed\x20command\x20execution','start','../../api/error-reporter.api','runUrl','createStartRequest','log','message','DistributedExecutionApi','completeRunGroupWithError','Successfully\x20completed\x20running\x20the\x20command.','Main\x20job\x20was\x20terminated\x20via\x20SIGINT','printRunGroupError','nxCloudDistributedTasksRunner','exit','endTasks','SIGTERM','../../file-storage/e2e-encryption','next','then','VERBOSE_LOGGING','E2EEncryption','__awaiter','canDetectRunGroup'];(function(_0x3cf3e3,_0x2670ed){const _0x1d2142=function(_0x16e00f){while(--_0x16e00f){_0x3cf3e3['push'](_0x3cf3e3['shift']());}};_0x1d2142(++_0x2670ed);}(a11_0x2670,0x164));const a11_0x1d21=function(_0x3cf3e3,_0x2670ed){_0x3cf3e3=_0x3cf3e3-0x0;let _0x1d2142=a11_0x2670[_0x3cf3e3];return _0x1d2142;};'use strict';var __awaiter=this&&this[a11_0x1d21('0x29')]||function(_0x314769,_0x27dcee,_0x51a127,_0x2af280){function _0xf1d6c3(_0x37ffdb){return _0x37ffdb instanceof _0x51a127?_0x37ffdb:new _0x51a127(function(_0x30a67b){_0x30a67b(_0x37ffdb);});}return new(_0x51a127||(_0x51a127=Promise))(function(_0x38fcaa,_0x583d49){function _0x1fa87e(_0x37c814){try{_0x5ee88c(_0x2af280[a11_0x1d21('0x25')](_0x37c814));}catch(_0x199184){_0x583d49(_0x199184);}}function _0x3f3345(_0x309f64){try{_0x5ee88c(_0x2af280['throw'](_0x309f64));}catch(_0x4debbc){_0x583d49(_0x4debbc);}}function _0x5ee88c(_0x37a3a4){_0x37a3a4[a11_0x1d21('0x4')]?_0x38fcaa(_0x37a3a4[a11_0x1d21('0x0')]):_0xf1d6c3(_0x37a3a4[a11_0x1d21('0x0')])[a11_0x1d21('0x26')](_0x1fa87e,_0x3f3345);}_0x5ee88c((_0x2af280=_0x2af280['apply'](_0x314769,_0x27dcee||[]))[a11_0x1d21('0x25')]());});};Object[a11_0x1d21('0x33')](exports,a11_0x1d21('0x38'),{'value':!![]});exports['nxCloudDistributedTasksRunner']=void 0x0;const dte_artifact_storage_1=require('../../../utilities/dte-artifact-storage');const environment_1=require(a11_0x1d21('0x37'));const metric_logger_1=require('../../../utilities/metric-logger');const error_reporter_api_1=require(a11_0x1d21('0x16'));const print_run_group_error_1=require(a11_0x1d21('0xb'));const e2e_encryption_1=require(a11_0x1d21('0x24'));const file_storage_1=require('../../file-storage/file-storage');const distributed_execution_api_1=require('./distributed-execution.api');const process_tasks_1=require('./process-tasks');const split_task_graph_into_stages_1=require('./split-task-graph-into-stages');const task_graph_creator_1=require('./task-graph-creator');const {output}=require(a11_0x1d21('0xa'));const {cacheDirectory}=require(a11_0x1d21('0x34'));class NoopLifeCycle{[a11_0x1d21('0x32')](_0x387bd7){}['startTask'](_0x1ef8c4){}[a11_0x1d21('0x22')](_0x2178bb){}}const nxCloudDistributedTasksRunner=(_0x1000eb,_0x36ea7c,_0x3e1fd7)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(_0x36ea7c[a11_0x1d21('0x2f')]){output[a11_0x1d21('0x1')]({'title':a11_0x1d21('0x2b'),'bodyLine':['DTE\x20needs\x20the\x20cache\x20to\x20share\x20files\x20between\x20agents.']});}if(environment_1[a11_0x1d21('0x27')]){output[a11_0x1d21('0x12')]({'title':a11_0x1d21('0x14')});}_0x36ea7c[a11_0x1d21('0x13')]=new NoopLifeCycle();const _0x43362d=(0x0,environment_1[a11_0x1d21('0x2')])();const _0x42f943=(0x0,environment_1['getRunGroup'])();const _0x4483c2=(0x0,environment_1[a11_0x1d21('0x2c')])();const _0x4588c4=(0x0,environment_1[a11_0x1d21('0xc')])();const _0x79c8ed=(0x0,environment_1[a11_0x1d21('0x5')])();const _0x396994=(0x0,environment_1['extractGitRef'])();if(!(0x0,print_run_group_error_1[a11_0x1d21('0x2a')])(_0x42f943,_0x4483c2)){(0x0,print_run_group_error_1[a11_0x1d21('0x1f')])();process[a11_0x1d21('0x21')](0x1);}const _0x168a01=new e2e_encryption_1[(a11_0x1d21('0x28'))](environment_1['ENCRYPTION_KEY']||_0x36ea7c[a11_0x1d21('0x36')]);const _0xf96c11=new error_reporter_api_1[(a11_0x1d21('0x9'))](_0x36ea7c);const _0x3a2686=new dte_artifact_storage_1[(a11_0x1d21('0x35'))](new file_storage_1['FileStorage'](_0x168a01,_0xf96c11,_0x36ea7c,a11_0x1d21('0xe')),cacheDirectory);const _0x146a80=new distributed_execution_api_1[(a11_0x1d21('0x1b'))](_0x36ea7c);attachSignalListenersToCompleteRunGroupOnError(_0x146a80,_0x43362d,_0x42f943,_0x4483c2,_0x4588c4);try{const _0x525457=getTaskGraph(_0x3e1fd7,_0x1000eb,_0x36ea7c);const _0x1fa7e6=yield runDistributedExecution(_0x146a80,_0x36ea7c,_0x3a2686,_0x43362d,_0x42f943,_0x4483c2,_0x4588c4,_0x525457,_0x79c8ed,_0x396994);if(_0x1fa7e6['commandStatus']===0x0){output['success']({'title':a11_0x1d21('0x1d'),'bodyLines':[a11_0x1d21('0x30')+_0x1fa7e6['runUrl']]});}else{output['error']({'title':a11_0x1d21('0x8'),'bodyLines':[a11_0x1d21('0x30')+_0x1fa7e6[a11_0x1d21('0x17')]]});}yield(0x0,metric_logger_1[a11_0x1d21('0x6')])(_0x36ea7c);process[a11_0x1d21('0x21')](_0x1fa7e6['commandStatus']);}catch(_0x34e9df){output['error']({'title':a11_0x1d21('0x3'),'bodyLines':[_0x34e9df[a11_0x1d21('0x1a')]]});if(_0x34e9df[a11_0x1d21('0x10')]){console[a11_0x1d21('0x19')](_0x34e9df[a11_0x1d21('0x10')]);}else{console['log'](_0x34e9df);}try{yield _0x146a80[a11_0x1d21('0x1c')](_0x43362d,_0x42f943,_0x4483c2,_0x4588c4,a11_0x1d21('0x11')+_0x34e9df[a11_0x1d21('0x1a')]+'\x22');}finally{process[a11_0x1d21('0x21')](0x1);}}});exports[a11_0x1d21('0x20')]=nxCloudDistributedTasksRunner;function getTaskGraph(_0x5be47e,_0x518b1c,_0x2f803f){if(_0x5be47e[a11_0x1d21('0x31')]){return _0x5be47e[a11_0x1d21('0x31')];}else{return(0x0,task_graph_creator_1[a11_0x1d21('0x2e')])(_0x2f803f,_0x5be47e[a11_0x1d21('0x2d')],_0x518b1c);}}function attachSignalListenersToCompleteRunGroupOnError(_0x58f8c8,_0x1a5f36,_0x130a89,_0x46fdd8,_0x38b4d3){process['on'](a11_0x1d21('0xd'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x58f8c8[a11_0x1d21('0x1c')](_0x1a5f36,_0x130a89,_0x46fdd8,_0x38b4d3,a11_0x1d21('0x1e'));process[a11_0x1d21('0x21')](0x1);}));process['on'](a11_0x1d21('0x23'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x58f8c8['completeRunGroupWithError'](_0x1a5f36,_0x130a89,_0x46fdd8,_0x38b4d3,a11_0x1d21('0xf'));process['exit'](0x1);}));}function runDistributedExecution(_0xc3bb71,_0x18ca77,_0xf5a012,_0x150ebc,_0x363ca5,_0x35bd03,_0x4de3e8,_0xa6f9b6,_0x3d46b6,_0x318fc1){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xb32f09=yield _0xc3bb71[a11_0x1d21('0x15')]((0x0,distributed_execution_api_1[a11_0x1d21('0x18')])(_0x150ebc,_0x363ca5,_0x35bd03,_0x4de3e8,(0x0,split_task_graph_into_stages_1[a11_0x1d21('0x7')])(_0xa6f9b6),_0x18ca77,_0x3d46b6));return yield(0x0,process_tasks_1['processTasks'])(_0xc3bb71,_0xf5a012,_0xb32f09,Object['values'](_0xa6f9b6['tasks']));});}