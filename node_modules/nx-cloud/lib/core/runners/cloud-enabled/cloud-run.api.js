const a3_0x3754=['length','Run\x20Details:','note','runUrl','defineProperty','map','../../../utilities/nx-imports-light','post','RunStart\x20duration','api','recordMetric','devDependencies','printDuration','apiAxiosInstance','Run\x20completion\x20responded\x20with\x20`undefined`.','message','nxCloudVersion','promisify','VERBOSE_LOGGING','RunStart','isConnectedToPrivateCloud','@nrwl/nx-cloud','assign','slice','readFileSync','startRun','next','unknown','stringify','../../../utilities/environment','done','Stack\x20Trace:','runContext','__awaiter','endRun','axiosMultipleTries','messages','package.json','parse','Invalid\x20Nx\x20Cloud\x20response:\x20','createReqBody','axiosException','Invalid\x20end\x20run\x20response','zlib','from','getRunGroup','mapRespToPerfEntry','value','headers','urls','util','application/octet-stream','data','../../../utilities/metric-logger','response','getCIExecutionId','../../../utilities/is-private-cloud','../../../utilities/axios','machineInfo','string','throw','createMetricRecorder','defaults','status','...','__esModule','Invalid\x20end\x20run\x20response:\x20','toString','terminalOutput','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','/nx-cloud/runs/start','apiError','RUNNER_FAILURE_PERF_ENTRY','success','getBranch'];(function(_0x5b7d8a,_0x375415){const _0x3cae78=function(_0x4766cb){while(--_0x4766cb){_0x5b7d8a['push'](_0x5b7d8a['shift']());}};_0x3cae78(++_0x375415);}(a3_0x3754,0x7c));const a3_0x3cae=function(_0x5b7d8a,_0x375415){_0x5b7d8a=_0x5b7d8a-0x0;let _0x3cae78=a3_0x3754[_0x5b7d8a];return _0x3cae78;};'use strict';var __awaiter=this&&this[a3_0x3cae('0x3b')]||function(_0x144b32,_0x46aad2,_0x368861,_0x34ca5f){function _0x1020f5(_0x5e897b){return _0x5e897b instanceof _0x368861?_0x5e897b:new _0x368861(function(_0x5ccb6a){_0x5ccb6a(_0x5e897b);});}return new(_0x368861||(_0x368861=Promise))(function(_0x1192bd,_0x23fc11){function _0x4e4574(_0x32dd07){try{_0x308f35(_0x34ca5f[a3_0x3cae('0x34')](_0x32dd07));}catch(_0x7ba238){_0x23fc11(_0x7ba238);}}function _0x15bdb3(_0x44c699){try{_0x308f35(_0x34ca5f[a3_0x3cae('0xb')](_0x44c699));}catch(_0x71114b){_0x23fc11(_0x71114b);}}function _0x308f35(_0x490b28){_0x490b28[a3_0x3cae('0x38')]?_0x1192bd(_0x490b28[a3_0x3cae('0x49')]):_0x1020f5(_0x490b28['value'])['then'](_0x4e4574,_0x15bdb3);}_0x308f35((_0x34ca5f=_0x34ca5f['apply'](_0x144b32,_0x46aad2||[]))[a3_0x3cae('0x34')]());});};Object[a3_0x3cae('0x1e')](exports,a3_0x3cae('0x10'),{'value':!![]});exports['CloudRunApi']=void 0x0;const fs_1=require('fs');const util_1=require(a3_0x3cae('0x1'));const zlib_1=require(a3_0x3cae('0x45'));const axios_1=require(a3_0x3cae('0x8'));const environment_1=require(a3_0x3cae('0x37'));const is_private_cloud_1=require(a3_0x3cae('0x7'));const metric_logger_1=require(a3_0x3cae('0x4'));const {output}=require(a3_0x3cae('0x20'));class CloudRunApi{constructor(_0x1ba899,_0xae58b5,_0x4dda0e,_0x2b21c2){this[a3_0x3cae('0x3e')]=_0x1ba899;this[a3_0x3cae('0x3a')]=_0xae58b5;this['machineInfo']=_0x2b21c2;this[a3_0x3cae('0x27')]=(0x0,axios_1['createApiAxiosInstance'])(_0x4dda0e);}[a3_0x3cae('0x33')](_0x5ce473,_0x58c3e1){var _0x5ccabb;return __awaiter(this,void 0x0,void 0x0,function*(){if(this['messages'][a3_0x3cae('0x16')])return{};const _0x1a7284=(0x0,metric_logger_1[a3_0x3cae('0xc')])(a3_0x3cae('0x33'));try{const _0x2a11e2={'meta':{'nxCloudVersion':this[a3_0x3cae('0x2a')]()},'branch':(0x0,environment_1[a3_0x3cae('0x19')])(),'runGroup':(0x0,environment_1[a3_0x3cae('0x47')])(),'ciExecutionId':(0x0,environment_1[a3_0x3cae('0x6')])(),'ciExecutionEnv':(0x0,environment_1['getCIExecutionEnv'])(),'distributedExecutionId':_0x5ce473,'hashes':_0x58c3e1,'machineInfo':this[a3_0x3cae('0x9')]};if(environment_1[a3_0x3cae('0x2c')]){output[a3_0x3cae('0x1c')]({'title':a3_0x3cae('0x2d'),'bodyLines':['\x0a'+JSON[a3_0x3cae('0x36')](_0x2a11e2,null,0x2)]});}const _0x2356a5=yield(0x0,axios_1[a3_0x3cae('0x26')])(a3_0x3cae('0x22'),()=>(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x3cae('0x27')][a3_0x3cae('0x21')](a3_0x3cae('0x15'),_0x2a11e2)));_0x1a7284['recordMetric']((0x0,metric_logger_1[a3_0x3cae('0x48')])(_0x2356a5));if(_0x2356a5[a3_0x3cae('0x3')]&&_0x2356a5[a3_0x3cae('0x3')][a3_0x3cae('0x29')]){this['messages']['message']=_0x2356a5[a3_0x3cae('0x3')][a3_0x3cae('0x29')];}if(!_0x2356a5['data']||!_0x2356a5[a3_0x3cae('0x3')][a3_0x3cae('0x0')]){this[a3_0x3cae('0x3e')]['apiError']=a3_0x3cae('0x41')+JSON[a3_0x3cae('0x36')](_0x2356a5[a3_0x3cae('0x3')]);return{};}return _0x2356a5[a3_0x3cae('0x3')]['urls'];}catch(_0x3b134f){_0x1a7284[a3_0x3cae('0x24')](((_0x5ccabb=_0x3b134f===null||_0x3b134f===void 0x0?void 0x0:_0x3b134f[a3_0x3cae('0x43')])===null||_0x5ccabb===void 0x0?void 0x0:_0x5ccabb[a3_0x3cae('0x5')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x3b134f[a3_0x3cae('0x43')][a3_0x3cae('0x5')]):metric_logger_1[a3_0x3cae('0x17')]);this[a3_0x3cae('0x3e')]['apiError']=this[a3_0x3cae('0x3e')]['extractErrorMessage'](_0x3b134f,'api');return{};}});}[a3_0x3cae('0x42')](_0x229f0b,_0x41be10,_0x5d7d21,_0x3b02d5){if((0x0,is_private_cloud_1[a3_0x3cae('0x2e')])()){for(let _0xd74f5b of _0x41be10){delete _0xd74f5b['uploadedToStorage'];}}const _0x428fa8=Object[a3_0x3cae('0x30')](Object[a3_0x3cae('0x30')]({'meta':{'nxCloudVersion':this[a3_0x3cae('0x2a')]()},'tasks':_0x41be10,'run':_0x229f0b,'linkId':_0x3b02d5},(0x0,is_private_cloud_1[a3_0x3cae('0x2e')])()?{}:_0x5d7d21),{'machineInfo':this[a3_0x3cae('0x9')]});return JSON['stringify'](_0x428fa8);}[a3_0x3cae('0x3c')](_0x308603,_0x1ef07a,_0x3d3191,_0x2b5613){var _0x9b1167,_0x2d84a7;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x3cae('0x3e')][a3_0x3cae('0x16')])return![];let _0x253f90=this[a3_0x3cae('0x42')](_0x308603,_0x1ef07a,_0x3d3191,_0x2b5613);if(_0x253f90[a3_0x3cae('0x1a')]>0x14*0x3e8*0x3e8){_0x253f90=this[a3_0x3cae('0x42')](_0x308603,_0x1ef07a['map'](_0x191faa=>Object[a3_0x3cae('0x30')](Object[a3_0x3cae('0x30')]({},_0x191faa),{'hashDetails':undefined})),_0x3d3191,_0x2b5613);}const _0x55289e=Buffer[a3_0x3cae('0x46')](_0x253f90);const _0x49dbc4=yield(0x0,util_1[a3_0x3cae('0x2b')])(zlib_1['gzip'])(_0x55289e);const _0x544b39=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x3cae('0x3c'));try{if(environment_1['VERBOSE_LOGGING']){const _0x1b99e1=_0x1ef07a[a3_0x3cae('0x1f')](_0x5d27b3=>{return Object[a3_0x3cae('0x30')](Object[a3_0x3cae('0x30')]({},_0x5d27b3),{'terminalOutput':_0x5d27b3['terminalOutput']?_0x5d27b3[a3_0x3cae('0x13')][a3_0x3cae('0x31')](0x0,0x14)+a3_0x3cae('0xf'):undefined});});output[a3_0x3cae('0x1c')]({'title':'RunEnd.\x20Completed\x20tasks','bodyLines':['\x0a'+JSON['stringify'](_0x1b99e1,null,0x2)]});}const _0x170b4c=yield(0x0,axios_1[a3_0x3cae('0x26')])('RunEnd\x20duration',()=>(0x0,axios_1[a3_0x3cae('0x3d')])(()=>this[a3_0x3cae('0x27')][a3_0x3cae('0x21')]('/nx-cloud/runs/end',_0x49dbc4,{'headers':Object['assign'](Object['assign']({},this['apiAxiosInstance'][a3_0x3cae('0xd')][a3_0x3cae('0x4a')]),{'Content-Encoding':'gzip','Content-Type':a3_0x3cae('0x2')})})));if(_0x170b4c){_0x544b39[a3_0x3cae('0x24')]((0x0,metric_logger_1[a3_0x3cae('0x48')])(_0x170b4c));if(_0x170b4c[a3_0x3cae('0x3')]&&_0x170b4c['data'][a3_0x3cae('0x1d')]&&_0x170b4c[a3_0x3cae('0x3')][a3_0x3cae('0xe')]===a3_0x3cae('0x18')){this['runContext'][a3_0x3cae('0x1d')]=_0x170b4c[a3_0x3cae('0x3')][a3_0x3cae('0x1d')];return!![];}if(_0x170b4c['data']&&_0x170b4c[a3_0x3cae('0x3')][a3_0x3cae('0xe')]){this[a3_0x3cae('0x3e')][a3_0x3cae('0x16')]=a3_0x3cae('0x11')+JSON[a3_0x3cae('0x36')](_0x170b4c[a3_0x3cae('0x3')][a3_0x3cae('0x29')]);}else if(_0x170b4c[a3_0x3cae('0x3')]&&typeof _0x170b4c[a3_0x3cae('0x3')]===a3_0x3cae('0xa')){if(_0x170b4c['data']!=='success'){this[a3_0x3cae('0x3e')]['apiError']=a3_0x3cae('0x11')+JSON['stringify'](_0x170b4c[a3_0x3cae('0x3')]);}}else{this[a3_0x3cae('0x3e')][a3_0x3cae('0x16')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x3cae('0x36')](_0x170b4c[a3_0x3cae('0x3')]);}if(environment_1[a3_0x3cae('0x2c')]){output['note']({'title':a3_0x3cae('0x44'),'bodyLines':[JSON['stringify'](_0x170b4c[a3_0x3cae('0x3')],null,0x2)]});}}else{output['error']({'title':a3_0x3cae('0x14'),'bodyLines':[a3_0x3cae('0x28'),a3_0x3cae('0x1b'),JSON[a3_0x3cae('0x36')](_0x308603,null,0x2),a3_0x3cae('0x39'),JSON[a3_0x3cae('0x36')](new Error()['stack'],null,0x2)]});}return![];}catch(_0x3701ba){_0x544b39[a3_0x3cae('0x24')](((_0x9b1167=_0x3701ba===null||_0x3701ba===void 0x0?void 0x0:_0x3701ba[a3_0x3cae('0x43')])===null||_0x9b1167===void 0x0?void 0x0:_0x9b1167[a3_0x3cae('0x5')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x3701ba['axiosException'][a3_0x3cae('0x5')]):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);const _0xd066e9=(_0x2d84a7=_0x3701ba[a3_0x3cae('0x43')])!==null&&_0x2d84a7!==void 0x0?_0x2d84a7:_0x3701ba;this['messages'][a3_0x3cae('0x16')]=this[a3_0x3cae('0x3e')]['extractErrorMessage'](_0xd066e9,a3_0x3cae('0x23'));return![];}});}[a3_0x3cae('0x2a')](){try{const _0x1997f5=JSON[a3_0x3cae('0x40')]((0x0,fs_1[a3_0x3cae('0x32')])(a3_0x3cae('0x3f'))[a3_0x3cae('0x12')]());return _0x1997f5[a3_0x3cae('0x25')]['nx-cloud']||_0x1997f5[a3_0x3cae('0x25')][a3_0x3cae('0x2f')];}catch(_0x227c2b){return a3_0x3cae('0x35');}}}exports['CloudRunApi']=CloudRunApi;