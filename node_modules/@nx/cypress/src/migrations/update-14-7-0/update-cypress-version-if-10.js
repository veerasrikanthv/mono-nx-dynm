"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateCypressVersionIf10 = void 0;
const devkit_1 = require("@nx/devkit");
// don't import from root level to prevent issue where angular isn't installed.
const semver_1 = require("@nx/devkit/src/utils/semver");
const semver_2 = require("semver");
function updateCypressVersionIf10(tree) {
    const installedVersion = (0, devkit_1.readJson)(tree, 'package.json').devDependencies?.['cypress'];
    if (!installedVersion) {
        return;
    }
    const normalizedInstalledCypressVersion = (0, semver_1.checkAndCleanWithSemver)('cypress', installedVersion);
    // not using v10
    if ((0, semver_2.lt)(normalizedInstalledCypressVersion, '10.0.0') ||
        (0, semver_2.gte)(normalizedInstalledCypressVersion, '11.0.0')) {
        return;
    }
    const ngComponentTestingVersion = '10.7.0';
    if ((0, semver_2.lt)(normalizedInstalledCypressVersion, ngComponentTestingVersion)) {
        (0, devkit_1.updateJson)(tree, 'package.json', (json) => {
            json.devDependencies['cypress'] = `^${ngComponentTestingVersion}`;
            return json;
        });
        return () => {
            (0, devkit_1.installPackagesTask)(tree);
        };
    }
}
exports.updateCypressVersionIf10 = updateCypressVersionIf10;
exports.default = updateCypressVersionIf10;
