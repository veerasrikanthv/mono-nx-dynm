"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setTargetDependencies = void 0;
const devkit_1 = require("@nx/devkit");
const output_1 = require("../../utilities/output");
async function setTargetDependencies(host) {
    const config = (0, devkit_1.readNxJson)(host);
    const strictlyOrderedTargets = config.tasksRunnerOptions?.['default']?.options
        ?.strictlyOrderedTargets || ['build'];
    delete config.tasksRunnerOptions?.['default']?.options
        ?.strictlyOrderedTargets;
    config.targetDependencies = config.targetDependencies ?? {};
    const updatedStrictlyOrderedTargets = [];
    strictlyOrderedTargets.forEach((target) => {
        if (!config.targetDependencies[target]) {
            config.targetDependencies[target] = [
                { target, projects: 'dependencies' },
            ];
            updatedStrictlyOrderedTargets.push(target);
        }
    });
    (0, devkit_1.updateNxJson)(host, config);
    if (updatedStrictlyOrderedTargets.length > 0) {
        output_1.output.note({
            title: 'Target dependencies have been updated in nx.json',
            bodyLines: [
                `Nx has deprecated strictlyOrderedTargets in favour of targetDependencies.`,
                `Based on your configuration the migration has configured targetDependencies for the following targets: ${updatedStrictlyOrderedTargets.join(', ')}.`,
                `Read more here: https://nx.dev/reference/project-configuration`,
            ],
        });
    }
    await (0, devkit_1.formatFiles)(host);
}
exports.setTargetDependencies = setTargetDependencies;
exports.default = setTargetDependencies;
