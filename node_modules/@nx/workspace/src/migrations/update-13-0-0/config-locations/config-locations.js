"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
async function update(tree) {
    const nxJson = (0, devkit_1.readJson)(tree, 'nx.json');
    // updateProjectConfiguration automatically saves the project opts into workspace/project.json
    if (nxJson.projects) {
        Object.entries(nxJson.projects).forEach(([p, nxJsonConfiguration]) => {
            const configuration = (0, devkit_1.readProjectConfiguration)(tree, p);
            configuration.tags ??= nxJsonConfiguration.tags;
            configuration.implicitDependencies ??=
                nxJsonConfiguration.implicitDependencies;
            (0, devkit_1.updateProjectConfiguration)(tree, p, configuration);
        });
        delete nxJson.projects;
    }
    (0, devkit_1.writeJson)(tree, 'nx.json', nxJson);
    movePropertiesAreInNewLocations(tree); // move config options to new spots.
    await (0, devkit_1.formatFiles)(tree);
}
exports.default = update;
/**
 * `updateWorkspaceConfiguration` already handles
 * placing properties in their new locations, so
 * reading + updating it ensures that props are placed
 * correctly.
 */
function movePropertiesAreInNewLocations(tree) {
    return;
}
