"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.enableSourceAnalysis = void 0;
const devkit_1 = require("@nx/devkit");
async function enableSourceAnalysis(tree) {
    (0, devkit_1.updateJson)(tree, 'nx.json', (config) => {
        if (config.extends === 'nx/presets/core.json' ||
            config.extends === 'nx/presets/npm.json') {
            const explicitlyDisabled = config.pluginsConfig &&
                config.pluginsConfig['@nrwl/js'] &&
                config.pluginsConfig['@nrwl/js'].analyzeSourceFiles === false;
            if (!explicitlyDisabled) {
                config.pluginsConfig ||= {};
                config.pluginsConfig['@nrwl/js'] ||= {};
                config.pluginsConfig['@nrwl/js'].analyzeSourceFiles = true;
            }
        }
        return config;
    });
    await (0, devkit_1.formatFiles)(tree);
}
exports.enableSourceAnalysis = enableSourceAnalysis;
exports.default = enableSourceAnalysis;
